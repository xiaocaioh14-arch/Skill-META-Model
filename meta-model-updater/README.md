# 📊 元模型自动更新器

> **自动化 AGENTS.md 规则 1 的执行**
> 这是解决"元模型更新工作流触发机制"问题的核心方案

---

## 🎯 这个 Skill 解决了什么问题？

### 问题回顾

之前的工作流存在"鸡生蛋"悖论：

```
AGENTS.md 规则说:"修改 SKILL.md 时,自动更新元模型"
     ↓
但 AI 需要先读取 AGENTS.md 才知道这个规则
     ↓
而 AI 不会自动读取 AGENTS.md
     ↓
结果: 规则永远不会自动触发 ❌
```

### 解决方案

**将规则转化为可调用的 Skill！**

- ✅ 降低记忆负担 - 只需记住一个触发词
- ✅ 流程标准化 - 每次更新都按统一的检查清单执行
- ✅ 自动去重 - 避免重复添加相似模式
- ✅ 立即可用 - 无需安装任何依赖

---

## 🚀 快速开始

### 触发方式

在 Cowork 中说以下任一短语：

```bash
# 方式 1: 自然语言
"更新元模型"
"update meta model"
"分析新模式"

# 方式 2: 斜杠命令
/update-meta-model

# 方式 3: 指定 Skill 路径
/update-meta-model ~/Project/组织文化分析/
```

### 执行效果

```
✅ 元模型更新完成

📊 本次更新:
  - 分析 Skill: carrier-analyzer
  - 新增模式: 模式 11: [新模式名称]
  - 更新文件: SKILL_META_MODEL.md (+80行)
  - 更新文件: SKILLS_INDEX.md (新增条目)

💡 下一步建议:
  - 查看 git diff 了解详细变更
  - 复用新模式到其他 3 个场景
  - 将核心代码片段提取到模板库
```

---

## 📋 执行流程

```
Step 1: 扫描最近 24h 修改的 SKILL.md
   ↓
Step 2: 读取 SKILL_META_MODEL.md (现有 10 个模式)
   ↓
Step 3: 使用 6 大维度检查清单分析新 Skill
   │
   ├─ 工作流模式维度
   ├─ 算法模型维度
   ├─ 输出格式维度
   ├─ 错误处理维度
   ├─ 外部集成维度
   └─ 内容分析维度
   ↓
Step 4: 自动去重（与现有模式对比）
   │
   ├─ 相似度 ≥ 0.85 → duplicate (不添加)
   ├─ 相似度 0.65-0.84 → variant (不添加)
   ├─ 相似度 0.45-0.64 → enhancement (合并)
   └─ 相似度 < 0.45 → novel (新增)
   ↓
Step 5: 更新 SKILL_META_MODEL.md
   ↓
Step 6: 同步更新 SKILLS_INDEX.md
   ↓
Step 7: 输出结构化摘要
```

---

## 🔍 分析维度详解

### 六大分析维度

| 维度 | 检查内容 | 示例 |
|------|---------|------|
| **1. 工作流模式** | 步骤组织、串联/并联、交互流程 | 阶段化工作流、双报告架构 |
| **2. 算法模型** | 数据处理算法、评分逻辑、容错策略 | 多层估算、加权评分 |
| **3. 输出格式** | 文件格式组合、视觉设计、报告结构 | 双视觉风格、径向思维导图 |
| **4. 错误处理** | 降级策略、错误恢复、质量追踪 | AI Fallback、置信度标注 |
| **5. 外部集成** | API 集成、浏览器自动化、数据同步 | 链式调用、持久化登录 |
| **6. 内容分析** | 理解方法、场景重构、幻觉防止 | 基于事实的场景重构 |

### 通用性测试标准

```yaml
必须通过所有 4 个测试:

✅ 测试 1: 适用场景数量 ≥ 3
✅ 测试 2: 有清晰的伪代码或实现逻辑
✅ 测试 3: 与现有模式有本质区别
✅ 测试 4: 能追溯到源 Skill 的具体实现
```

---

## 📊 去重逻辑

### 相似度判断规则

```python
相似度 = 核心特征相似度(40%) +
        应用场景重叠度(30%) +
        实现逻辑相似度(30%)

判定结果:
  ≥ 0.85 → duplicate   # 完全重复，不添加
  0.65-0.84 → variant     # 现有模式变体，不添加
  0.45-0.64 → enhancement # 增强现有模式，合并
  < 0.45 → novel         # 全新模式，可添加
```

### 与现有 10 个模式的对比

每个新模式都会与以下 10 个现有模式逐一对比：

1. 静默执行协议
2. AI Fallback 降级
3. 双格式输出标配
4. 脚本分离架构
5. 阶段化工作流
6. 双报告架构
7. 多层估算模型
8. 加权评分系统
9. 模板驱动报告
10. 基于事实的场景重构

---

## 💡 使用建议

### 何时触发

✅ **推荐触发时机**:
- ✅ 每次开发新 Skill 后
- ✅ 修改现有 Skill 的核心逻辑后
- ✅ 每周回顾时，批量分析近期修改

❌ **不推荐触发时机**:
- ❌ 仅修改 Skill 的文档说明
- ❌ 仅调整输出格式（无逻辑变化）
- ❌ 修改辅助脚本（不涉及 SKILL.md）

### 最佳实践

**开发新 Skill 的完整流程**:

```
1. 需求分析 → 确定要解决的问题
2. 设计蓝图 → 定义 I/O 契约和核心逻辑
3. 编写 SKILL.md → 按标准模板创建
4. 测试验证 → 确保各场景运行正常
5. 触发更新 → 说"更新元模型"          ⬅️ 使用本 Skill
6. 查看摘要 → 了解是否有新模式产生
7. 复用推广 → 将新模式应用到其他场景
```

---

## 📁 文件结构

```
skill 元模型/
└── meta-model-updater/
    ├── SKILL.md         # 核心 Skill 定义（1500+ 行）
    └── README.md        # 本文档（使用指南）
```

---

## 🎓 示例场景

### 场景 1: 发现全新模式

```
用户: "更新元模型"

Skill 执行:
  1. 扫描发现: ~/Project/组织文化分析/SKILL.md (修改于 2h 前)
  2. 分析识别: "基于事实的场景重构"方法
  3. 对比现有模式: 相似度 < 0.4 → 判定为 novel
  4. 通用性评分: 85/100 → 值得添加
  5. 添加为"模式 10"

输出:
  ✅ 新增模式: 模式 10 - 基于事实的场景重构
  📁 更新文件: SKILL_META_MODEL.md (+120行)
  💡 建议: 可复用到所有对话类内容分析
```

---

### 场景 2: 识别重复模式

```
用户: "/update-meta-model ~/Project/简单邮件分析/"

Skill 执行:
  1. 直接分析指定路径
  2. 识别: "静默执行 + 双格式输出"
  3. 对比: 与模式 1、3 相似度 > 0.85
  4. 判定: duplicate → 不添加

输出:
  ⚠️ 未发现新模式 (与现有模式重复)
  💡 建议: 直接复用"模式 1"和"模式 3"
```

---

### 场景 3: 增强现有模式

```
用户: "分析新模式"

Skill 执行:
  1. 扫描发现: 4层 Fallback Skill
  2. 识别: 在 AI Fallback 基础上增加了数据库查询
  3. 相似度: 0.68 → 判定为 enhancement
  4. 操作: 更新"模式 2"章节

输出:
  ✅ 增强现有模式: 模式 2 (AI Fallback)
  📝 新增: 第四层降级策略
  📁 更新文件: SKILL_META_MODEL.md (更新模式2)
```

---

## 🛠️ 高级功能

### 批量分析（计划中）

```bash
/update-meta-model --batch
# 分析最近 7 天内修改的所有 Skill
```

### 对比报告（计划中）

```bash
/update-meta-model --report
# 生成详细的模式对比报告（不修改元模型）
```

### 回滚功能（计划中）

```bash
/update-meta-model --rollback
# 撤销最近一次更新（基于 Git 历史）
```

---

## ⚠️ 注意事项

### 依赖文件

本 Skill 依赖以下文件：

| 文件 | 路径 | 说明 |
|------|------|------|
| SKILL_META_MODEL.md | `~/Project/` | 必须存在 |
| SKILLS_INDEX.md | `~/Project/` | 必须存在 |
| AGENTS.md | `~/Project/` | 可选（用于理解规则） |

### 权限要求

- ✅ 读取权限: `~/Project/**/*.md`
- ✅ 写入权限: `SKILL_META_MODEL.md`, `SKILLS_INDEX.md`
- ⚠️ 建议在 Git 仓库中执行，便于查看变更和回滚

---

## 🎉 价值总结

### 解决的核心问题

| 问题 | 解决方案 |
|------|---------|
| ❌ AI 不会自动记住规则 | ✅ 转化为可调用的 Skill |
| ❌ 更新流程不标准 | ✅ 统一的 6 维度检查清单 |
| ❌ 容易重复添加模式 | ✅ 自动去重逻辑 |
| ❌ 忘记更新元模型 | ✅ 明确的触发词提醒 |

### 带来的好处

1. **降低记忆负担** - 只需记住"更新元模型"
2. **提升质量** - 标准化的分析流程
3. **节省时间** - 自动对比、去重、更新
4. **知识沉淀** - 确保每个新模式都被记录
5. **持续改进** - 元模型始终保持最新

---

## 📚 相关文档

| 文档 | 路径 | 说明 |
|------|------|------|
| AGENTS.md | `~/Project/AGENTS.md` | 跨工具协作规则 |
| SKILL_META_MODEL.md | `~/Project/SKILL_META_MODEL.md` | 元模型主文档 |
| SKILLS_INDEX.md | `~/Project/SKILLS_INDEX.md` | Skill 索引 |
| 工作流诊断报告 | `~/Project/工作流诊断报告.md` | 问题分析 |
| 改进建议 | `~/Project/AGENTS_改进建议.md` | 详细方案 |

---

## 🚀 下一步

1. **立即测试** - 说"更新元模型"，看看效果
2. **养成习惯** - 每次开发 Skill 后都触发一次
3. **查看变更** - 使用 `git diff` 检查更新内容
4. **持续改进** - 根据使用体验优化检查清单

---

*这个 Skill 是解决"元模型更新触发机制"问题的核心方案*
*让规则从"需要记住"变成"可以调用"* 🎯
